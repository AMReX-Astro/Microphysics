<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>NSE &mdash; Microphysics  documentation</title>
      <link rel="stylesheet" href="_static/theme_overrides.css" type="text/css" />
      <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="_static/jquery.js"></script>
        <script src="_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="_static/sphinx_highlight.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
        <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true, "macros": {"rhozero": "{\\rho_0}", "pizero": "{\\pi_0}", "pizeroone": "{\\pi_0^{(1)}}", "pizerotwo": "{\\pi_0^{(2)}}", "gammabar": "{\\overline{\\Gamma}_1}", "ptl": "{{\\partial}}", "eb": "{{\\bf e}}", "fb": "{{\\bf f}}", "ib": "{{\\bf i}}", "Ub": "{{\\bf U}}", "Vb": "{{\\bf V}}", "xb": "{{\\bf x}}", "ut": "{\\tilde{u}}", "vt": "{\\tilde{v}}", "wt": "{\\tilde{w}}", "Ubt": "{\\widetilde{\\Ub}}", "edge": "{\\rm EDGE}", "mac": "{\\rm MAC}", "trans": "{\\rm TRANS}", "nablab": "{\\mathbf{\\nabla}}", "cdotb": "{\\mathbf{\\cdot}}", "half": "{\\frac{1}{2}}", "myhalf": "{\\frac{1}{2}}", "nph": "{{n + \\myhalf}}", "nmh": "{{n - \\myhalf}}", "Hext": "{{H_{\\rm ext}}}", "Hnuc": "{{H_{\\rm nuc}}}", "kth": "{k_{\\rm th}}", "pred": "{{\\rm pred}}", "Sbar": "{\\overline{S}}", "inp": "{\\mathrm{in}}", "initp": "{\\mathrm{init}}", "outp": "{\\mathrm{out}}", "uadv": "{\\widetilde{\\mathbf{U}}^{\\mathrm{ADV}}}", "uadvone": "{\\widetilde{\\mathbf{U}}^{\\mathrm{ADV},\\star}}", "uadvonedag": "{\\Ubt^{\\mathrm{ADV},\\dagger,\\star}}", "uadvtwo": "{\\widetilde{\\mathbf{U}}^{\\mathrm{ADV}}}", "uadvtwodag": "{\\Ubt^{\\mathrm{ADV},\\dagger}}", "uadvsdcstar": "{\\mathbf{U}^{\\mathrm{ADV},\\star}}", "uadvsdcpred": "{\\mathbf{U}^{\\mathrm{ADV},\\mathrm{pred}}}", "uadvsdc": "{\\mathbf{U}^{\\mathrm{ADV}}}", "dt": "{\\Delta t}", "dr": "{\\Delta r}", "etarho": "{\\eta_{\\rho}}", "etarhoec": "{\\etarho^{\\rm ec}}", "etarhocc": "{\\etarho^{\\rm cc}}", "etarhoflux": "{\\etarho^{\\rm flux}}", "divetarho": "{\\nabla\\cdot(\\etarho\\eb_r)}", "ow": "{\\overline{w}_0}", "dw": "{\\delta w_0}", "thalf": "{\\sfrac{3}{2}}", "rhop": "{{\\rho^{\\prime}}}", "omegadot": "{\\dot{\\omega}}", "er": "{\\mathbf{e}_r}", "ex": "{\\mathbf{e}_x}", "ey": "{\\mathbf{e}_y}", "ez": "{\\mathbf{e}_z}", "Omegab": "{{\\bf \\Omega}}", "rb": "{{\\bf r}}", "isotm": ["{{}^{#2}\\mathrm{#1}}", 2], "edot": "{{{\\dot{e}_\\mathrm{nuc}}}}", "enuc": "{{{{e}_\\mathrm{nuc}}}}", "edotnu": "{{{\\dot{e}_\\nu}}}", "rt": "{\\tilde{r}_0}", "rhob": "{\\ensuremath{\\rho_\\mathrm{base}}}", "Tb": "{\\ensuremath{T_\\mathrm{base}}}", "gcc": "{\\mathrm{g~cm^{-3} }}", "pb": "{p_\\mathrm{base}}", "qburn": "{q_\\mathrm{burn}}", "Uc": "{{\\boldsymbol{\\mathcal{U}}}}", "Fb": "{\\mathbf{F}}", "Sc": "{\\mathbf{S}}", "Shydro": "{{{\\bf S}^{\\mathrm{hydro}}}}", "Rb": "{{\\bf R}}", "Rq": "{{\\bf R}}", "Adv": ["{{\\left [\\boldsymbol{\\mathcal{A}} \\left(#1\\right)\\right]}}", 1], "Advs": ["{{\\boldsymbol{\\mathcal{A}} \\left(#1\\right)}}", 1], "Sdot": "{\\dot{S}}"}}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
        <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Transport Coefficients" href="transport.html" />
    <link rel="prev" title="Integrating a Network" href="integrators.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >


          
          
          <a href="index.html" class="icon icon-home">
            Microphysics
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
    <div class="branch">
        Branch: <a href="../nse.html">main</a> | <a href="./nse.html">development</a>
    </div>

        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Microphysics basics</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="preface.html">Preface</a></li>
<li class="toctree-l1"><a class="reference internal" href="basics.html">StarKiller Basics</a></li>
<li class="toctree-l1"><a class="reference internal" href="data_structures.html">Data Structures</a></li>
<li class="toctree-l1"><a class="reference internal" href="rp_intro.html">Runtime parameters</a></li>
<li class="toctree-l1"><a class="reference internal" href="eos.html">Equations of State</a></li>
<li class="toctree-l1"><a class="reference internal" href="networks-overview.html">Overview of Reaction Networks</a></li>
<li class="toctree-l1"><a class="reference internal" href="networks.html">Available Reaction Networks</a></li>
<li class="toctree-l1"><a class="reference internal" href="templated_networks.html">Templated Network Righthand Sides</a></li>
<li class="toctree-l1"><a class="reference internal" href="screening.html">Screening of Reaction Rates</a></li>
<li class="toctree-l1"><a class="reference internal" href="integrators.html">Integrating a Network</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">NSE</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#tabulated-nse-and-aprox19">Tabulated NSE and <code class="docutils literal notranslate"><span class="pre">aprox19</span></code></a><ul>
<li class="toctree-l3"><a class="reference internal" href="#composition-and-eos">Composition and EOS</a></li>
<li class="toctree-l3"><a class="reference internal" href="#nse-table-outputs">NSE Table Outputs</a></li>
<li class="toctree-l3"><a class="reference internal" href="#nse-flow">NSE Flow</a></li>
<li class="toctree-l3"><a class="reference internal" href="#nse-check">NSE check</a></li>
<li class="toctree-l3"><a class="reference internal" href="#nse-table-ranges">NSE table ranges</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#id3">Self-consistent NSE</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#dynamic-nse-check">Dynamic NSE Check</a></li>
<li class="toctree-l3"><a class="reference internal" href="#additional-options">Additional Options</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="transport.html">Transport Coefficients</a></li>
<li class="toctree-l1"><a class="reference internal" href="unit_tests.html">Unit Tests</a></li>
<li class="toctree-l1"><a class="reference internal" href="sdc.html">Spectral Deferred Corrections</a></li>
<li class="toctree-l1"><a class="reference internal" href="zreferences.html">References</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Microphysics</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">NSE</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/nse.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="nse">
<h1>NSE<a class="headerlink" href="#nse" title="Permalink to this heading"></a></h1>
<p>The reaction networks in Microphysics have the ability to use NSE
instead of integrating the entire network when the conditions are
appropriate.  There are 2 different implementations of NSE in
Microphysics, that have slightly different use cases.</p>
<ul>
<li><p><a class="reference internal" href="#tabulated-nse"><span class="std std-ref">Tabulated NSE and aprox19</span></a> : this uses a table of NSE abundances given
<span class="math notranslate nohighlight">\((\rho, T, Y_e)\)</span> generate from a large network (125 isotopes).
The table also returns <span class="math notranslate nohighlight">\(dY_e/dt\)</span> resulting from
electron-captures, to allow for the NSE state to evolve.  This is
meant to be used in the cores of massive stars and works only with the
<code class="docutils literal notranslate"><span class="pre">aprox19</span></code> reaction network.</p>
<p>Furthermore, since the table can achieve <span class="math notranslate nohighlight">\(Y_e\)</span> and
<span class="math notranslate nohighlight">\(\bar{A}\)</span> that are not representable by the 19 isotopes in
<code class="docutils literal notranslate"><span class="pre">aprox19</span></code>, this table requires that we use the auxiliary
composition and advect <span class="math notranslate nohighlight">\(Y_e\)</span>, <span class="math notranslate nohighlight">\(\bar{A}\)</span>, and
<span class="math notranslate nohighlight">\(\langle B/A\rangle\)</span>.  All of the EOS calls will work with
these quantities.</p>
<p>This is enabled via <code class="docutils literal notranslate"><span class="pre">USE_NSE_TABLE</span></code></p>
</li>
<li><p><a class="reference internal" href="#self-consistent-nse"><span class="std std-ref">NSE table ranges</span></a> : this adds an NSE solver to the network that
can be called to find the equilibrium abundances of each of the
species defined in the network.  It works with any of the
pynucastro-generated networks.  Unlike the tabulated NSE, there is
no need to advect the auxiliary composition, since this only deals
with the isotopes defined in the main reaction network.</p>
<p>This is enabled via <code class="docutils literal notranslate"><span class="pre">USE_NSE_NET</span></code></p>
</li>
</ul>
<p>Both solvers define a number of preprocessor variables, and both will
provide a function <code class="docutils literal notranslate"><span class="pre">in_nse()</span></code> that can be used to determine if a
state is currently in NSE.</p>
<table class="docutils align-default">
<tbody>
<tr class="row-odd"><td><p>make option</p></td>
<td><p>preprocessor variables set</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">USE_NSE_TABLE</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">NSE</span></code>, <code class="docutils literal notranslate"><span class="pre">NSE_TABLE</span></code>, <code class="docutils literal notranslate"><span class="pre">AUX_THERMO</span></code></p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">USE_NSE_NET</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">NSE</span></code>, <code class="docutils literal notranslate"><span class="pre">NSE_NET</span></code></p></td>
</tr>
</tbody>
</table>
<p>The directive <code class="docutils literal notranslate"><span class="pre">NSE</span></code> should be used whether the specific
implementation of NSE does not matter.</p>
<p>These two NSE solvers are described below.</p>
<section id="tabulated-nse-and-aprox19">
<span id="tabulated-nse"></span><h2>Tabulated NSE and <code class="docutils literal notranslate"><span class="pre">aprox19</span></code><a class="headerlink" href="#tabulated-nse-and-aprox19" title="Permalink to this heading"></a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">aprox19</span></code> network can be run in a manner where we blends the
standard <code class="docutils literal notranslate"><span class="pre">aprox19</span></code> network with a table for nuclear statistic
equilibrium resulting from a much larger network at high density and
temperatures.    This option is enabled by building with:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><style type="text/css">
span.prompt1:before {
  content: "$ ";
}
</style><span class="prompt1"><span class="nv">NETWORK_DIR</span><span class="o">=</span>aprox19<span class="w"> </span><span class="nv">USE_NSE_TABLE</span><span class="o">=</span>TRUE</span>
</pre></div></div><section id="composition-and-eos">
<h3>Composition and EOS<a class="headerlink" href="#composition-and-eos" title="Permalink to this heading"></a></h3>
<p>The NSE table was generated using a 125 nuclei reaction network
(described in <span id="id1">[<a class="reference internal" href="zreferences.html#id29" title="H. Ma, S. E. Woosley, C. M. Malone, A. Almgren, and J. Bell. Carbon Deflagration in Type Ia Supernova. I. Centrally Ignited Models. \apj , 771(1):58, jul 2013. arXiv:1305.2433, doi:10.1088/0004-637X/771/1/58.">MaWoosleyMalone+13</a>]</span>), and includes electron-capture rates,
so the compositional quantities it carries, <span class="math notranslate nohighlight">\(\bar{A}\)</span> and
<span class="math notranslate nohighlight">\(Y_e\)</span> and not representable from the 19 isotopes we carry in the
network.  In particular, it can attain a lower <span class="math notranslate nohighlight">\(Y_e\)</span> than
<code class="docutils literal notranslate"><span class="pre">aprox19</span></code> can represent.</p>
<p>For this reason, when we are using the NSE network, we always take the
composition quantities in the EOS directly from <code class="docutils literal notranslate"><span class="pre">eos_state.aux[]</span></code>
instead of from <code class="docutils literal notranslate"><span class="pre">eos_state.xn[]</span></code>.  The <code class="docutils literal notranslate"><span class="pre">AUX_THERMO</span></code> preprocessor
variable is enabled in this case, and the equations of state interpret
this to use the auxiliary data for the composition.  This is described in <a class="reference internal" href="eos.html#aux-eos-comp"><span class="std std-ref">Auxiliary Composition</span></a>.</p>
</section>
<section id="nse-table-outputs">
<h3>NSE Table Outputs<a class="headerlink" href="#nse-table-outputs" title="Permalink to this heading"></a></h3>
<p>The NSE table provides values for the auxiliary composition,
<span class="math notranslate nohighlight">\(Y_e\)</span>, <span class="math notranslate nohighlight">\(\bar{A}\)</span>, and <span class="math notranslate nohighlight">\(\langle B/A \rangle\)</span>
resulting from the full 125 nuclei network.   It also provides a set of 19
<span class="math notranslate nohighlight">\(X_k\)</span> that map into the isotopes carried by <code class="docutils literal notranslate"><span class="pre">aprox19</span></code>.</p>
<p>These three quantities are stored as <code class="docutils literal notranslate"><span class="pre">aux</span></code> data in the network and
are indexed as <code class="docutils literal notranslate"><span class="pre">iye</span></code>, <code class="docutils literal notranslate"><span class="pre">iabar</span></code>, and <code class="docutils literal notranslate"><span class="pre">ibea</span></code>.  Additionally, when
coupling to hydrodynamics, we need to advect these auxiliary
quantities.</p>
<p>For Strang split coupling of hydro and reactions, <span class="math notranslate nohighlight">\(DX_k/Dt = 0\)</span>,
and our evolution equations are:</p>
<div class="math notranslate nohighlight">
\[\begin{split}\begin{align*}
\frac{DY_e}{Dt} &amp;= \sum_k \frac{Z_k}{A_k} \frac{DX_k}{Dt} = 0 \\
\frac{D}{Dt} \frac{1}{\bar{A}} &amp;= - \frac{1}{\bar{A}^2} \frac{D\bar{A}}{Dt} = \sum_k \frac{1}{A_k} \frac{DX_k}{Dt} = 0 \rightarrow \frac{D\bar{A}}{Dt} = 0 \\
\frac{D}{Dt} \left (\frac{B}{A} \right ) &amp;= \sum_k \frac{B_k}{A_k} \frac{DX_k}{Dt} = 0
\end{align*}\end{split}\]</div>
<p>Therefore each of these auxiliary equations obeys an advection equation
in the hydro part of the advancement.</p>
</section>
<section id="nse-flow">
<h3>NSE Flow<a class="headerlink" href="#nse-flow" title="Permalink to this heading"></a></h3>
<p>The basic flow of a simulation using <code class="docutils literal notranslate"><span class="pre">aprox19</span></code> + the NSE table is as follows:</p>
<ul>
<li><p>initialize the problem, including <span class="math notranslate nohighlight">\(X_k\)</span></p></li>
<li><p>fill the initial aux data with <span class="math notranslate nohighlight">\(Y_e\)</span>, <span class="math notranslate nohighlight">\(\bar{A}\)</span>, and <span class="math notranslate nohighlight">\((B/A)\)</span></p></li>
<li><p>in hydro, we will update these quantities simply via advection (for
Strang-split evolution)</p></li>
<li><p>for the reactive update:</p>
<ul>
<li><p>check if NSE applies (see below)</p></li>
<li><p>if we are in an NSE region:</p>
<ul>
<li><p>use <span class="math notranslate nohighlight">\(\rho\)</span>, <span class="math notranslate nohighlight">\(T\)</span>, and <span class="math notranslate nohighlight">\(Y_e\)</span> to call the table.
This returns: <span class="math notranslate nohighlight">\(dY_e/dt\)</span>, <span class="math notranslate nohighlight">\((B/A)_{\rm out}\)</span>, and <span class="math notranslate nohighlight">\(\bar{A}_{\rm out}\)</span>.</p></li>
<li><p>update <span class="math notranslate nohighlight">\(Y_e\)</span> <a class="footnote-reference brackets" href="#fy" id="id2" role="doc-noteref"><span class="fn-bracket">[</span>1<span class="fn-bracket">]</span></a> :</p>
<div class="math notranslate nohighlight">
\[(Y_e)_{\rm out} = (Y_e)_{\rm in} + \Delta t \frac{dY_e}{dt}\]</div>
</li>
<li><p><span class="math notranslate nohighlight">\(\bar{A}_{\rm out}\)</span> is simply the value returned from the table</p></li>
<li><p>the energy generation rate, <span class="math notranslate nohighlight">\(e_{\rm nuc}\)</span> is:</p>
<div class="math notranslate nohighlight">
\[e_{\rm nuc} = \eta \left [ \left ( \frac{B}{A} \right )_{\rm out} -
                           \left ( \frac{B}{A} \right )_{\rm in} \right ] * \frac{1.602 \times 10^{-6}  {\rm erg}}{{\rm MeV}} N_A \frac{1}{\Delta t}\]</div>
<p>where <span class="math notranslate nohighlight">\(\eta\)</span> is an inertia term &lt; 1 to prevent the energy changing too much in one set.</p>
</li>
<li><p>the new binding energy for the zone is then:</p>
<div class="math notranslate nohighlight">
\[\left ( \frac{B}{A} \right )_{\rm out}  = \left ( \frac{B}{A} \right )_{\rm in} + \eta \left [ \left ( \frac{B}{A} \right )_{\rm out} - \left ( \frac{B}{A} \right )_{\rm in} \right ]\]</div>
</li>
<li><p>update the mass fractions, <span class="math notranslate nohighlight">\(X_k\)</span>, using the values from the table</p></li>
</ul>
</li>
<li><p>if we are not in NSE:</p>
<ul class="simple">
<li><p>integrate the <code class="docutils literal notranslate"><span class="pre">aprox19</span></code> network as usual</p></li>
<li><p>update the aux quantities at the end of the burn</p></li>
</ul>
</li>
</ul>
</li>
</ul>
</section>
<section id="nse-check">
<h3>NSE check<a class="headerlink" href="#nse-check" title="Permalink to this heading"></a></h3>
<p>We determine is a zone is in NSE according to:</p>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(\rho\)</span> &gt; <code class="docutils literal notranslate"><span class="pre">rho_nse</span></code></p></li>
<li><p><span class="math notranslate nohighlight">\(T\)</span> &gt; <code class="docutils literal notranslate"><span class="pre">T_nse</span></code></p></li>
<li><p><span class="math notranslate nohighlight">\(X(\isotm{C}{12})\)</span> &lt; <code class="docutils literal notranslate"><span class="pre">C_nse</span></code></p></li>
<li><p><span class="math notranslate nohighlight">\(X(\isotm{He}{4}) + X(\isotm{Cr}{48}) + X(\isotm{Fe}{52}) + X(\isotm{Fe}{54}) + X(\isotm{Ni}{56})\)</span> &gt; <code class="docutils literal notranslate"><span class="pre">He_Fe_nse</span></code></p></li>
</ul>
</section>
<section id="nse-table-ranges">
<span id="self-consistent-nse"></span><h3>NSE table ranges<a class="headerlink" href="#nse-table-ranges" title="Permalink to this heading"></a></h3>
<p>The NSE table was created for:</p>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(9 &lt; \log_{10}(T) &lt; 10.4\)</span></p></li>
<li><p><span class="math notranslate nohighlight">\(7 &lt; \log_{10}(\rho) &lt; 10\)</span></p></li>
<li><p><span class="math notranslate nohighlight">\(0.4 &lt; Y_e &lt; 0.5\)</span></p></li>
</ul>
</section>
</section>
<section id="id3">
<h2>Self-consistent NSE<a class="headerlink" href="#id3" title="Permalink to this heading"></a></h2>
<p>The self-consistent NSE approach uses only the nuclei in the main
reaction network.  It solves for the chemical potentials of the proton
and neutron and from there gets the abundances of each of the nuclei
under the assumption of NSE, following the procedure outlined in <span id="id4">[<a class="reference internal" href="zreferences.html#id36" title="A. C. Calder, D. M. Townsley, I. R. Seitenzahl, F. Peng, O. E. B. Messer, N. Vladimirova, E. F. Brown, J. W. Truran, and D. Q. Lamb. Capturing the fire: flame energetics and neutronization for type ia supernova simulations. The Astrophysical Journal, 656(1):313–332, feb 2007. URL: https://doi.org/10.1086/510709, doi:10.1086/510709.">CTS+07</a>]</span>.</p>
<p>The solve is done using a port of the hybrid Powell method from
MINPACK (we ported the solver to templated C++).</p>
<p>The advantage of this approach is that it can be used with any
reaction network, once the integration has reached NSE.</p>
<p>This solver is enabled by compiling with</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span class="prompt1"><span class="nv">USE_NSE_NET</span><span class="o">=</span>TRUE</span>
</pre></div></div><p>The functions to find the NSE state are then found in <code class="docutils literal notranslate"><span class="pre">nse_solver.H</span></code>.</p>
<section id="dynamic-nse-check">
<h3>Dynamic NSE Check<a class="headerlink" href="#dynamic-nse-check" title="Permalink to this heading"></a></h3>
<p>We have implemented a dynamic NSE check for the self-consistent nse procedure
that tells us whether the network has reached the NSE state. The overall procedure
is outlined in <span id="id5">[<a class="reference internal" href="zreferences.html#id42" title="Doron Kushnir and Boaz Katz. An accurate and efficient numerical calculation of detonation waves in multidimensional supernova simulations using a burning limiter and adaptive quasi-statistical equilibrium. Monthly Notices of the Royal Astronomical Society, 493(4):5413-5433, April 2020. arXiv:1912.06151.">KushnirKatz20</a>]</span>. The overall usage comes down to a single function
<code class="docutils literal notranslate"><span class="pre">in_nse(state)</span></code>. By supplying the current state, this function returns a boolean that
tells us whether we’re in NSE or not. The current status of this functionality only
works for pynucastro-generated network since aprox networks have slightly different syntax.
Note that we ignore this check when <code class="docutils literal notranslate"><span class="pre">T</span> <span class="pre">&lt;</span> <span class="pre">2.0e9</span></code>, since we don’t expect NSE to occur when
temperature is below 2 billion Kelvin.</p>
<p>There are 3 main criteria discussed in the <span id="id6">[<a class="reference internal" href="zreferences.html#id42" title="Doron Kushnir and Boaz Katz. An accurate and efficient numerical calculation of detonation waves in multidimensional supernova simulations using a burning limiter and adaptive quasi-statistical equilibrium. Monthly Notices of the Royal Astronomical Society, 493(4):5413-5433, April 2020. arXiv:1912.06151.">KushnirKatz20</a>]</span>.</p>
<ul>
<li><p>Have a rough check to determine whether the current state is close to NSE. They use a
criteria of:</p>
<div class="math notranslate nohighlight">
\[\frac{r - r_{NSE}}{r_{NSE}} &lt; 0.5\]</div>
<p>where <span class="math notranslate nohighlight">\(r = Y_\alpha/(Y_p^2 Y_n^2)\)</span> and
<span class="math notranslate nohighlight">\(r_{NSE} = \left(Y_\alpha/(Y_p^2 Y_n^2)\right)_{NSE}\)</span>.</p>
</li>
<li><p>Does the network has a fast reaction cycle that exchanges 1 <span class="math notranslate nohighlight">\(\alpha\)</span> particle with
2 <span class="math notranslate nohighlight">\(p\)</span> and 2 <span class="math notranslate nohighlight">\(n\)</span> particles. This cycle should have the following reactions or
their reverse:</p>
<ul class="simple">
<li><p>1 <span class="math notranslate nohighlight">\((\alpha, \gamma)\)</span>, 2 <span class="math notranslate nohighlight">\((\gamma, p)\)</span>, 2 <span class="math notranslate nohighlight">\((\gamma, n)\)</span></p></li>
<li><p>1 <span class="math notranslate nohighlight">\((\alpha, p)\)</span>, 1 <span class="math notranslate nohighlight">\((\gamma, p)\)</span>, 2 <span class="math notranslate nohighlight">\((\gamma, n)\)</span></p></li>
<li><p>1 <span class="math notranslate nohighlight">\((\alpha, n)\)</span>, 2 <span class="math notranslate nohighlight">\((\gamma, p)\)</span>, 1 <span class="math notranslate nohighlight">\((\gamma, n)\)</span></p></li>
</ul>
<p>To consider to be fast reaction cycle, we require every step in the cycle to
have <span class="math notranslate nohighlight">\(Y_i/\textbf{min}(b_f, b_r) &lt; \epsilon t_s\)</span> for <span class="math notranslate nohighlight">\(i = n, p, \alpha\)</span>
participated in this step, where <span class="math notranslate nohighlight">\(b_f\)</span> and <span class="math notranslate nohighlight">\(b_r\)</span>
are the forward and reverse rate of the reaction, <span class="math notranslate nohighlight">\(\epsilon\)</span> is a tolerance which
has a default value of <span class="math notranslate nohighlight">\(0.1\)</span>, and <span class="math notranslate nohighlight">\(t_s\)</span> is the sound crossing time of a
simulation cell.</p>
<p>An example of such reaction cycle would be:</p>
<div class="math notranslate nohighlight">
\[\isotm{S}{32} (\gamma, p)(\gamma, p)(\gamma, n)(\gamma, n) \isotm{Si}{28}
(\alpha, \gamma) \isotm{S}{32}\]</div>
<p>The general approach to this is to start iterations from the heavy to the light nuclei to
use them as the starting point of the cycle. Then the algorithm checks if isotopes involved
in the network can actually form a cycle using the combination reactions above. If such cycle
is formed, then we check the rates of these reactions to see if they satisfy the condition
mention previously. If there are no isotope present in the network that would form
a closed-cycle, we move on to the next nuclei. We break out of the iteration once we found
a fast reaction cycle.</p>
</li>
<li><p>If the previous two check pass, we proceed to nuclei grouping. Initially,
<span class="math notranslate nohighlight">\(p\)</span>, <span class="math notranslate nohighlight">\(n\)</span>, and <span class="math notranslate nohighlight">\(\alpha\)</span> are grouped into a single group called
the light-isotope-group, or LIG. Other isotopes belong to their own group,
which only contains themselves. During each iteration, we find all valid reaction,
<span class="math notranslate nohighlight">\(k\)</span>, that has the fastest time-scale,
<span class="math notranslate nohighlight">\(t_{i,k} = \tilde{Y}_i/\textbf{min}(b_f(k), b_r(k))\)</span>, for <span class="math notranslate nohighlight">\(i\)</span> to be the isotope
involved with the reaction that is different from <span class="math notranslate nohighlight">\(p\)</span>, <span class="math notranslate nohighlight">\(n\)</span>, and <span class="math notranslate nohighlight">\(\alpha\)</span>.
<span class="math notranslate nohighlight">\(\tilde{Y}_i\)</span> represents the sum of molar fractions of the group that isotope <span class="math notranslate nohighlight">\(i\)</span>
belongs in, or <span class="math notranslate nohighlight">\(\tilde{Y}_i = \Sigma_{l \in q}Y^l_i\)</span>. After determining which reaction
has the fastest time-scale, there are two requirements for us to check whether this reaction
can be used to group the nuclei involved, which are:</p>
<ul>
<li><p>at least 1 isotope, <span class="math notranslate nohighlight">\(i\)</span>, that passes:</p>
<div class="math notranslate nohighlight">
\[t_{i,k} &lt; \epsilon t_s\]</div>
<ul class="simple">
<li></li>
</ul>
<div class="math notranslate nohighlight">
\[2|b_f(k) - b_r(k)|/(b_f(k) + b_r(k) &lt; \epsilon\]</div>
</li>
</ul>
<p>Here we only consider two cases of reactions:</p>
<ul class="simple">
<li><p>There are exactly two isotopes involved in reaction, <span class="math notranslate nohighlight">\(k\)</span>, that are not in the
light-isotope-group. In this case, if the reaction passes the two criteria mentioned above,
we merge the groups containing those two isotopes if they’re not yet in the same group.</p></li>
<li><p>There is only one isotope involved in reaction, <span class="math notranslate nohighlight">\(k\)</span>, that is not in the
light-isotope-group, which is not necessarily isotope <span class="math notranslate nohighlight">\(i\)</span> that passes the
first criteria. In this case, we merge the isotope that is not in LIG into LIG.</p></li>
</ul>
<p>Here we skip over reactions of the following due to obvious reasons:</p>
<ul class="simple">
<li><p>Reactions that have no reverse rates.</p></li>
<li><p>Reactions that involve more than 2 reactants and products</p></li>
<li><p>Reactions that have more than 2 non-light-isotope-group.</p></li>
<li><p>The nuclei that participate in the reaction is either in LIG or in another group.
This means that the non-LIG nuclei have already merged.</p></li>
</ul>
<p>And the iteration stops once there are no reactions that can satisfy the above criteria.
At the end of the iterations, we define that the current state  have reached NSE
when there is only a single group left, or there are two groups left where
1 of them is the light-isotope-group.</p>
</li>
</ul>
</section>
<section id="additional-options">
<h3>Additional Options<a class="headerlink" href="#additional-options" title="Permalink to this heading"></a></h3>
<p>Here we have some runtime options to allow a more cruel estimation to the self-consistent
nse check:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">nse.nse_dx_independent</span> <span class="pre">=</span> <span class="pre">1</span></code> in the input file allows the nse check to ignore
the dependency on the cell size, <code class="docutils literal notranslate"><span class="pre">dx</span></code>, which calculates the sound crossing time, <code class="docutils literal notranslate"><span class="pre">t_s</span></code>.
Naturally, we require the timescale of the rates to be smaller than <code class="docutils literal notranslate"><span class="pre">t_s</span></code> to ensure the
states have time to achieve equilibrium. However, sometimes this check can be difficult
to achieve, so we leave this as an option for the user to explore.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">nse.nse_molar_independent</span> <span class="pre">=</span> <span class="pre">1</span></code> in the input file allows the user to use the nse mass
fractions for nse check after the first check (the one that ensures we’re close enough
to the nse mass fractions to get reasonable results) is passed. This allows the subsequent
checks to only rely on the thermodynamic conditions instead of mass fractions.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">nse.nse_skip_molar</span> <span class="pre">=</span> <span class="pre">1</span></code> in the input file allows the user to skip the molar fraction
check after the integration has failed. This option is used to completely forgo the
requirement on molar fractions and allow the check to only dependent on the thermodynamic
conditions. By only applying this after option after the integration failure, we hope the
integrator has evolved the system to the NSE state the best it can. By turning on this
option, we hope to give relief to the integrator if the system is in NSE thermodynamically,
which is likely the case.</p></li>
</ul>
<p class="rubric">Footnotes</p>
<aside class="footnote-list brackets">
<aside class="footnote brackets" id="fy" role="note">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id2">1</a><span class="fn-bracket">]</span></span>
<p>The table actually provides the weak rate, which is the sum
of all electron capture and positron decay rates times the
appropriate abundances minus a similar rate for the beta decay and
positron capture, [wrate] = [rectot] + [rpdtot] - [redtot] - [rpctot]</p>
<p>So if electron capture dominates, then [wrate] is positive and this should
be subtracted from <span class="math notranslate nohighlight">\(Y_e\)</span>.</p>
</aside>
</aside>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="integrators.html" class="btn btn-neutral float-left" title="Integrating a Network" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="transport.html" class="btn btn-neutral float-right" title="Transport Coefficients" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2012, Microphysics Development Team.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>  


</body>
</html>